<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mapa de Assentos - Casamento</title>
    
    <!-- React Core -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Fontes -->
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Lato', sans-serif; background-color: #F9F6F2; overflow: hidden; /* Evita scroll duplo */ }
        h1, h2, h3, .font-serif { font-family: 'Playfair Display', serif; }
        
        /* Animação para destacar o lugar */
        @keyframes pulse-seat {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(244, 63, 94, 0.7); }
            70% { transform: scale(1.2); box-shadow: 0 0 0 10px rgba(244, 63, 94, 0); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(244, 63, 94, 0); }
        }
        .animate-pulse-seat {
            animation: pulse-seat 1.5s infinite;
        }
        
        /* Scroll suave e sem barra visual */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body>

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        // --- CONFIGURAÇÃO DO LAYOUT (CORRIGIDO V9) ---
        const TABLE_CONFIG = [
            // --- DECK (ZONA: DECK) ---
            { id: 1, name: "Mesa 1", zone: "deck", col: 1, segments: 10 },
            { id: 4, name: "Mesa 4", zone: "deck", col: 1, segments: 2 }, 

            // --- SALÃO FILEIRA 1 (Mesa 2 SOZINHA) ---
            { id: 2, name: "Mesa 2", zone: "salao", col: 1, segments: 10 },

            // --- SALÃO FILEIRA 2 (Mesa 3 + Mesa 5) ---
            { id: 3, name: "Mesa 3", zone: "salao", col: 2, segments: 7 },
            { id: 5, name: "Mesa 5", zone: "salao", col: 2, segments: 4 },

            // --- SALÃO FILEIRA 3 (Mesa 6 + Mesa 7) ---
            { id: 6, name: "Mesa 6", zone: "salao", col: 3, segments: 4 },
            { id: 7, name: "Mesa 7", zone: "salao", col: 3, segments: 3 }
        ];

        // Gerador de Dados Iniciais
        const generateInitialSeats = () => {
            const seats = [];
            
            TABLE_CONFIG.forEach(table => {
                for (let i = 0; i < table.segments; i++) {
                    // Laterais (Sempre existem)
                    seats.push({ id: `t${table.id}-s${i}-l`, tableGroupId: table.id, segmentIndex: i, positionType: 'left', guestName: '', groupTag: '' });
                    seats.push({ id: `t${table.id}-s${i}-r`, tableGroupId: table.id, segmentIndex: i, positionType: 'right', guestName: '', groupTag: '' });
                    
                    // Ponta Superior (Apenas no primeiro segmento)
                    if (i === 0) {
                        seats.push({ id: `t${table.id}-top`, tableGroupId: table.id, segmentIndex: i, positionType: 'top', guestName: '', groupTag: '' });
                    }
                    
                    // Ponta Inferior (Apenas no último segmento)
                    if (i === table.segments - 1) {
                        seats.push({ id: `t${table.id}-bottom`, tableGroupId: table.id, segmentIndex: i, positionType: 'bottom', guestName: '', groupTag: '' });
                    }
                }
            });
            return seats;
        };

        // --- APP PRINCIPAL ---
        function App() {
            const [view, setView] = useState('welcome'); 
            const [seats, setSeats] = useState(() => {
                // Nova chave para forçar recriação do layout correto
                const saved = localStorage.getItem('wedding_seats_v9_layout_corrected');
                return saved ? JSON.parse(saved) : generateInitialSeats();
            });
            
            const [searchTerm, setSearchTerm] = useState('');
            const [foundSeatIds, setFoundSeatIds] = useState([]);
            const [editingSeat, setEditingSeat] = useState(null);
            const [tempName, setTempName] = useState('');
            const [tempGroup, setTempGroup] = useState('');
            const scrollContainerRef = useRef(null);

            useEffect(() => {
                localStorage.setItem('wedding_seats_v9_layout_corrected', JSON.stringify(seats));
            }, [seats]);

            // Handlers
            const handleUpdateSeat = () => {
                if (!editingSeat) return;
                const updatedSeats = seats.map((s) => 
                    s.id === editingSeat.id ? { ...s, guestName: tempName, groupTag: tempGroup } : s
                );
                setSeats(updatedSeats);
                setEditingSeat(null);
                setTempName('');
                setTempGroup('');
            };

            const searchResults = useMemo(() => {
                if (searchTerm.length < 2) return [];
                return seats.filter(s => s.guestName.toLowerCase().includes(searchTerm.toLowerCase()));
            }, [searchTerm, seats]);

            const selectGuestSeat = (primarySeat) => {
                let idsToHighlight = [primarySeat.id];
                if (primarySeat.groupTag && primarySeat.groupTag.trim() !== '') {
                    const groupMembers = seats.filter(s => 
                        s.groupTag.toLowerCase() === primarySeat.groupTag.toLowerCase() && s.guestName.trim() !== ''
                    );
                    idsToHighlight = groupMembers.map(s => s.id);
                }
                setFoundSeatIds(idsToHighlight);
                setSearchTerm('');
                
                setTimeout(() => {
                    const element = document.getElementById(`seat-wrapper-${primarySeat.id}`);
                    if (element) {
                        element.scrollIntoView({ behavior: 'smooth', block: 'center', inline: 'center' });
                    }
                }, 100);
            };

            const handleBackgroundClick = () => {
                setFoundSeatIds([]);
            };

            const totalGuests = seats.filter(s => s.guestName.trim() !== '').length;
            const totalCapacity = seats.length; 

            // --- COMPONENTES VISUAIS ---

            const Chair = ({ seat }) => {
                const isOccupied = seat.guestName.trim() !== '';
                const isSelected = foundSeatIds.includes(seat.id);
                const isEditing = editingSeat?.id === seat.id;
                
                let wrapperPosClasses = '';
                switch (seat.positionType) {
                    case 'top': wrapperPosClasses = '-top-4 left-1/2 -translate-x-1/2'; break;
                    case 'bottom': wrapperPosClasses = '-bottom-4 left-1/2 -translate-x-1/2'; break;
                    case 'left': wrapperPosClasses = 'top-1/2 -left-4 -translate-y-1/2'; break;
                    case 'right': wrapperPosClasses = 'top-1/2 -right-4 -translate-y-1/2'; break;
                }

                return (
                    <div 
                        id={`seat-wrapper-${seat.id}`}
                        className={`absolute w-5 h-5 flex items-center justify-center z-20 ${wrapperPosClasses}`}
                        onClick={(e) => e.stopPropagation()}
                    >
                        <button
                            onClick={() => {
                                if (view === 'host') {
                                    setEditingSeat(seat);
                                    setTempName(seat.guestName);
                                    setTempGroup(seat.groupTag);
                                }
                            }}
                            disabled={view === 'guest'}
                            className={`
                                w-full h-full rounded-full border flex items-center justify-center transition-all duration-300 shadow-sm
                                ${isSelected ? 'bg-rose-500 border-rose-600 text-white animate-pulse-seat z-50 scale-125' : ''}
                                ${isEditing ? 'bg-blue-500 border-blue-600 ring-4 ring-blue-200 z-50' : ''}
                                ${!isSelected && !isEditing && isOccupied ? 'bg-emerald-100 border-emerald-300 text-emerald-800' : ''}
                                ${!isSelected && !isEditing && !isOccupied ? 'bg-white border-slate-300 hover:border-slate-400' : ''}
                            `}
                            title={seat.guestName || "Lugar Vazio"}
                        >
                            {isOccupied ? (
                                <i className={`fa-solid fa-user text-[8px] ${isSelected ? 'text-white' : ''}`}></i>
                            ) : (
                                <div className="w-1 h-1 bg-slate-200 rounded-full" />
                            )}
                        </button>
                    </div>
                );
            };

            const TableSegment = ({ groupId, index, isLast }) => {
                const segmentSeats = seats.filter(s => s.tableGroupId === groupId && s.segmentIndex === index);
                
                const borderClass = isLast 
                    ? 'border-2 border-t-0 rounded-b-lg' 
                    : index === 0 
                        ? 'border-2 border-b-2 rounded-t-lg' 
                        : 'border-x-2 border-b-2 rounded-none';

                return (
                    <div className={`
                        relative w-20 h-12 bg-white border-stone-300 flex items-center justify-center
                        ${borderClass}
                    `}>
                        <div className="absolute w-full h-[1px] bg-stone-100 top-0"></div>
                        {segmentSeats.map(seat => (
                            <Chair key={seat.id} seat={seat} />
                        ))}
                    </div>
                );
            };

            const LongTable = ({ config }) => (
                <div className="flex flex-col items-center flex-shrink-0 mb-8" onClick={(e) => e.stopPropagation()}>
                    <div className="mb-2 text-center sticky left-0 z-10">
                        <h3 className="font-serif text-xs text-rose-900 font-bold bg-[#F9F6F2]/90 backdrop-blur px-2 rounded border border-rose-100/50">{config.name}</h3>
                    </div>
                    <div className="flex flex-col shadow-lg shadow-stone-200/50">
                        {Array.from({ length: config.segments }).map((_, index) => (
                            <TableSegment 
                                key={index} 
                                groupId={config.id} 
                                index={index} 
                                isLast={index === config.segments - 1} 
                            />
                        ))}
                    </div>
                </div>
            );

            // --- TELAS ---

            if (view === 'welcome') {
                return (
                    <div className="min-h-screen flex flex-col items-center justify-center p-6 text-center overflow-y-auto">
                        <div className="bg-white p-8 rounded-2xl shadow-xl max-w-md w-full border border-stone-100">
                            <div className="w-16 h-16 bg-rose-50 rounded-full flex items-center justify-center mx-auto mb-6">
                                <i className="fa-solid fa-heart text-2xl text-rose-500"></i>
                            </div>
                            <h1 className="text-3xl font-serif text-slate-800 mb-2">Recepção do Casamento</h1>
                            <p className="text-slate-500 mb-8">Encontre seu lugar no mapa.</p>
                            
                            <button onClick={() => setView('guest')} className="w-full bg-slate-800 text-white py-3 rounded-xl mb-3 font-medium hover:bg-slate-700 transition flex items-center justify-center gap-3">
                                <i className="fa-solid fa-magnifying-glass"></i>
                                Buscar Meu Lugar
                            </button>
                            
                            <button onClick={() => setView('host')} className="w-full bg-white text-slate-600 border border-slate-200 py-3 rounded-xl font-medium hover:bg-slate-50 transition flex items-center justify-center gap-3">
                                <i className="fa-solid fa-pen-to-square"></i>
                                Área do Organizador
                            </button>
                        </div>
                    </div>
                );
            }

            return (
                <div className="h-screen w-screen font-sans flex flex-col bg-[#F9F6F2] overflow-hidden" onClick={handleBackgroundClick}>
                    {/* Header */}
                    <header className="bg-white/90 backdrop-blur-md shadow-sm border-b border-stone-100 h-14 flex-shrink-0 z-50" onClick={(e) => e.stopPropagation()}>
                        <div className="max-w-md mx-auto px-4 h-full flex items-center justify-between">
                            <div className="flex items-center gap-2 cursor-pointer" onClick={() => setView('welcome')}>
                                <i className="fa-solid fa-heart text-rose-500"></i>
                                <span className="font-serif text-base font-bold text-slate-800">Casamento</span>
                            </div>
                            {view === 'host' ? (
                                <div className="flex items-center gap-3">
                                    <span className="text-[10px] font-mono text-slate-500 bg-slate-100 px-2 py-1 rounded">{totalGuests}/{totalCapacity}</span>
                                    <button onClick={() => setView('welcome')} className="text-rose-600 text-xs font-bold uppercase tracking-wider">Sair</button>
                                </div>
                            ) : (
                                <button onClick={() => setView('welcome')} className="text-slate-400">
                                    <i className="fa-solid fa-arrow-right-from-bracket"></i>
                                </button>
                            )}
                        </div>
                    </header>

                    {/* Busca */}
                    <div className="absolute top-16 left-0 right-0 z-40 px-4 max-w-md mx-auto" onClick={(e) => e.stopPropagation()}>
                        <div className="relative shadow-xl rounded-full">
                            <div className="absolute inset-y-0 left-4 flex items-center pointer-events-none">
                                <i className="fa-solid fa-magnifying-glass text-slate-400"></i>
                            </div>
                            <input
                                type="text"
                                placeholder={view === 'guest' ? "Digite seu nome..." : "Buscar convidado..."}
                                className="w-full pl-11 pr-4 py-3 bg-white/95 backdrop-blur rounded-full border border-stone-200/50 outline-none text-slate-700 placeholder:text-slate-400 text-sm font-medium focus:ring-2 focus:ring-rose-200"
                                value={searchTerm}
                                onChange={(e) => setSearchTerm(e.target.value)}
                                onFocus={() => setFoundSeatIds([])}
                            />
                            {searchResults.length > 0 && (
                                <div className="absolute top-full left-4 right-4 mt-2 bg-white rounded-2xl shadow-2xl border border-slate-100 max-h-52 overflow-y-auto z-50">
                                    {searchResults.map(seat => (
                                        <button key={seat.id} onClick={() => selectGuestSeat(seat)} className="w-full text-left px-4 py-3 hover:bg-rose-50 border-b border-slate-50 flex items-center justify-between group last:border-0">
                                            <div>
                                                <div className="font-medium text-slate-700 truncate text-sm">{seat.guestName}</div>
                                                {seat.groupTag && <div className="text-[10px] text-slate-400 flex items-center gap-1"><i className="fa-solid fa-users text-[10px]"></i> {seat.groupTag}</div>}
                                            </div>
                                            <span className="text-[10px] font-bold text-rose-500 bg-rose-50 px-2 py-0.5 rounded-full">Mesa {seat.tableGroupId}</span>
                                        </button>
                                    ))}
                                </div>
                            )}
                        </div>
                    </div>

                    {/* Notificação Encontrado */}
                    {foundSeatIds.length > 0 && view === 'guest' && (
                        <div className="absolute top-32 left-4 right-4 z-30 transition-all duration-300 pointer-events-none">
                            <div className="bg-slate-800/90 backdrop-blur text-white rounded-xl p-3 text-center shadow-lg">
                                <p className="font-medium text-sm">Encontrado! <span className="text-rose-300">{foundSeatIds.length > 1 ? `Você e mais ${foundSeatIds.length - 1} pessoas` : 'Seu lugar foi localizado'}</span></p>
                            </div>
                        </div>
                    )}

                    {/* ÁREA DO MAPA COM SCROLL */}
                    <main className="flex-1 relative overflow-hidden w-full h-full">
                        <div 
                            ref={scrollContainerRef}
                            className="absolute inset-0 overflow-auto no-scrollbar pt-24 pb-20 px-4"
                        >
                            {/* Container Flex que permite scroll horizontal */}
                            <div className="flex justify-start min-w-max gap-8 pb-10">
                                
                                {/* COLUNA 1: DECK (Fixa a esquerda visualmente) */}
                                <div className="flex flex-col items-center min-w-[100px]">
                                    <span className="font-serif text-slate-400 font-bold tracking-widest uppercase text-[10px] mb-6 border-b border-slate-200 pb-1 px-2">Deck</span>
                                    {TABLE_CONFIG.filter(t => t.zone === 'deck').map(t => (
                                        <LongTable key={t.id} config={t} />
                                    ))}
                                </div>

                                {/* Divisória Vertical */}
                                <div className="w-[1px] bg-stone-300 h-[600px] mt-10 opacity-50 flex-shrink-0"></div>

                                {/* ÁREA DO SALÃO (AGORA COM 3 COLUNAS) */}
                                <div className="flex flex-col items-center">
                                    <span className="font-serif text-slate-400 font-bold tracking-widest uppercase text-[10px] mb-6 border-b border-slate-200 pb-1 px-2">Salão</span>
                                    
                                    <div className="flex gap-8">
                                        {/* SALÃO COLUNA 1: MESA 2 (SOZINHA) */}
                                        <div className="flex flex-col items-center min-w-[100px]">
                                            {TABLE_CONFIG.filter(t => t.zone === 'salao' && t.col === 1).map(t => (
                                                <LongTable key={t.id} config={t} />
                                            ))}
                                        </div>

                                        {/* SALÃO COLUNA 2: MESA 3 e 5 */}
                                        <div className="flex flex-col items-center min-w-[100px]">
                                            {TABLE_CONFIG.filter(t => t.zone === 'salao' && t.col === 2).map(t => (
                                                <LongTable key={t.id} config={t} />
                                            ))}
                                        </div>

                                        {/* SALÃO COLUNA 3: MESA 6 e 7 */}
                                        <div className="flex flex-col items-center min-w-[100px]">
                                            {TABLE_CONFIG.filter(t => t.zone === 'salao' && t.col === 3).map(t => (
                                                <LongTable key={t.id} config={t} />
                                            ))}
                                        </div>
                                    </div>
                                </div>

                                {/* Espaço extra para scroll confortável */}
                                <div className="w-4 flex-shrink-0"></div>
                            </div>
                        </div>
                        
                        {/* Indicador de Scroll */}
                        <div className="absolute bottom-4 left-0 right-0 flex justify-center pointer-events-none opacity-50">
                            <div className="bg-slate-900/10 rounded-full px-3 py-1 flex items-center gap-2 text-[10px] text-slate-500 font-medium">
                                <i className="fa-solid fa-arrows-left-right"></i>
                                Arraste para ver mais
                            </div>
                        </div>
                    </main>

                    {/* MODAL EDITAR */}
                    {editingSeat && (
                        <div className="fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-[100] flex items-center justify-center p-4" onClick={(e) => e.stopPropagation()}>
                            <div className="bg-white rounded-2xl shadow-2xl w-full max-w-sm overflow-hidden animate-in fade-in zoom-in-95 duration-200">
                                <div className="bg-slate-50 p-4 border-b border-slate-100 flex justify-between items-center">
                                    <h3 className="font-bold text-slate-800">Editar Assento</h3>
                                    <button onClick={() => setEditingSeat(null)} className="w-8 h-8 flex items-center justify-center rounded-full hover:bg-slate-200 text-slate-500">
                                        <i className="fa-solid fa-xmark"></i>
                                    </button>
                                </div>
                                <div className="p-6 space-y-4">
                                    <div className="bg-rose-50 border border-rose-100 rounded-lg p-3 text-sm text-rose-800 flex justify-between items-center">
                                        <div className="flex flex-col"><span className="font-bold">Mesa {editingSeat.tableGroupId}</span><span className="text-xs opacity-70">Posição {editingSeat.segmentIndex + 1}</span></div>
                                        <span className="text-xs font-bold uppercase bg-white px-2 py-1 rounded border border-rose-100">{editingSeat.positionType}</span>
                                    </div>
                                    <div>
                                        <label className="block text-xs font-bold uppercase tracking-wider text-slate-500 mb-1.5">Nome</label>
                                        <input autoFocus type="text" value={tempName} onChange={(e) => setTempName(e.target.value)} placeholder="Ex: João da Silva" className="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl outline-none" />
                                    </div>
                                    <div>
                                        <label className="block text-xs font-bold uppercase tracking-wider text-slate-500 mb-1.5 flex items-center gap-1"><i className="fa-solid fa-users"></i> Grupo / Família</label>
                                        <input type="text" value={tempGroup} onChange={(e) => setTempGroup(e.target.value)} placeholder="Ex: Família Silva" className="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl outline-none" />
                                    </div>
                                    <div className="flex gap-3 pt-2">
                                        <button onClick={() => { setTempName(''); setTempGroup(''); handleUpdateSeat(); }} className="flex-1 py-3 px-4 rounded-xl border border-slate-200 text-slate-500 font-semibold text-sm">Liberar</button>
                                        <button onClick={handleUpdateSeat} className="flex-1 py-3 px-4 rounded-xl bg-slate-900 text-white font-semibold shadow-lg">Salvar</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>


